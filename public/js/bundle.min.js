(function(){"use strict";const a={createElement:function(a,b,c="div"){let d=document.createElement(c);return b&&(d.id=b),this.addClasses(d,a),d},addHandler:function(a,b,c="click"){return a.addEventListener(c,b),a},addClasses:function(a,b){if(b){if("string"==typeof b){try{a.classList.add(b)}catch(a){console.warn("Multiple classes should be an array")}return a}if(0<b.length)return b.forEach(function(b){a.classList.add(b)}),a}return a},forceArray:function(a){return a||console.warn("UItools: forceArray: No value passed"),Array.isArray(a)||(a=[a]),a},getText:function(a,b,c,d="p"){let e=this.createElement(b,c,d);return e.innerText=a,e},getLink:function(a,b,c,d){let e=this.getText(a,c,d,"a");return e.href=b,e},getImage:function(a,b,c,d){let e=this.createElement(c,d,"img");return e.src=a,e},getList:function(a,b,c,d="ul"){const e=this.createElement(b,c,d);return a.forEach(a=>{"string"==typeof a&&(a=this.getListItem(a)),e.appendChild(a)}),e},getListItem:function(a,b,c){const d=this.createElement(b,c,"li");return d.innerText=a,d},getLinkListItem:function(a,b,c,d){const e=this.getListItem(null,c,d),f=this.getLink(a,b);return e.appendChild(f),e},getLabel:function(a,b,c){const d=this.getText(a,b,c,"label");return d},getInput:function(a,b,c,d="",e=" ",f){const g=[];"object"==typeof a&&a.setAttribute("for",c),a&&g.push(a);let h;return"select"===b?h=this.getSelect(c,d,f):"textarea"===b?h=this.createElement(f,c,"textarea"):(h=this.createElement(f,c,"input"),h.type=b),h.value=d,"submit"!==b&&(h.name=c,h.placeholder=e),g.push(h),!1===a||"hidden"===b?g[0]:this.wrap(g)},getButton:function(a,b,c,d){const e=this.createElement(b,c,"button");return e.innerText=a,d&&this.addHandler(e,d),e},getSelect:function(a,b,c,d){const e=this.createElement(c,d,"select");return e.name=a,b.forEach(a=>{const b=this.createElement(null,null,"option");b.value=a.value,b.innerText=a.label?a.label:a.value,e.appendChild(b)}),e},getForm:function(a,b,c="/",d="Submit",e,f){const g=this.createElement(e,f,"form");return g.action=c,g.name=a,b=this.forceArray(b),b.forEach(a=>{g.appendChild(a)}),!1!==d&&("string"==typeof d&&(d=this.getInput("","submit","",d)),g.appendChild(d)),g},render:function(a,b,c=!1,d=null){return c?b.insertBefore(a,d):(a=this.forceArray(a),a.forEach(a=>{b.insertBefore(a,d)})),a},wrap:function(a,b,c,d="div"){const e=this.createElement(b,c,d);return a=this.forceArray(a),a.forEach(a=>{"string"==typeof a&&(a=this.getText(a)),e.appendChild(a)}),e},renderIn:function(a,b,c,d,e="div"){return b?this.render(this.wrap(a,c,d,e),b):void console.warn("No container/target, you could use wrap() instead")},renderText:function(a,b,c,d,e="p"){return"string"==typeof a&&(a=this.getText(a)),this.renderIn(a,b,c,d,e)}};class b{constructor(a="api"){this.server=window.location.href+a}call(a,b){const c=new XMLHttpRequest;c.open("POST",this.server),c.setRequestHeader("Content-Type","application/json"),c.onload=function(){if(200===c.status){let a;try{a=JSON.parse(c.responseText)}catch(a){return b({err:"No JSON",data:c.responseText})}return b(a)}console.warn("API error: "+c.status)},c.send(JSON.stringify(a))}}class c{constructor(){this.api=new b}LoginHandler(a){a.preventDefault(),this.api=new b,this.api.call({action:"auth",username:document.querySelector("input[name=username]").value,password:document.querySelector("input[name=password]").value},a=>{console.log(a),a.err?console.warn(a.err):a.user?(localStorage.setItem("user",JSON.stringify(a.user)),console.log("User data received"),window.UI.RenderHome()):console.warn("Undefined error")})}EditScript(a){a.preventDefault(),window.UI.RenderScriptEdit()}AddMeta(b){b.preventDefault(),console.log("Adding meta",b.target.parentElement),a.render([a.getInput(!1,"text","metaID","","Meta Key"),a.getInput(!1,"select","metaType",[{value:"text"},{value:"email"}],"Meta Key")],b.target.parentElement,!1,b.target)}AddQuestion(b){b.preventDefault(),console.log("Adding question",b.target.parentElement),a.render([a.getInput(!1,"text","questionID","","Enter question")],b.target.parentElement,!1,b.target)}CancelEdit(a){a.preventDefault(),console.log("Cancel Script"),window.UI.RenderHome()}StoreScript(a){a.preventDefault(),console.log("Storing Script");this.api=new b,this.api.call({},a=>{console.log(a),a.err?console.warn(a.err):a.user?(console.log("User data received"),window.UI.RenderHome()):console.warn("Undefined error")})}}class d{constructor(){window.UI&&console.warn("UI already initialised"),window.UI=this,this.handlers=new c,this.body=document.body,this.main=a.render(a.createElement("content","","main"),document.body,!0),this.docTitle=document.querySelector("title"),this.SetTitle("test a title")}Clear(a){a.innerHTML="",a==this.main&&this.main.classList.remove("login")}SetTitle(a){this.docTitle.innerText=`${a} | Inter-view`,this.pageTitle&&(this.pageTitle.innerText=a)}GetLogo(){return a.getImage("/img/logo.svg","Inter-view Logo")}GetIcon(b,c,d){return c=a.forceArray(c),c.push("icon"),a.getImage(`/img/icons/svg/${b}.svg`,"TODO: Title from filename",c,d)}GetIconSVG(b,c,d){return c=a.forceArray(c),c.push("icon"),a.getImage(`/img/icons/svg/${b}.svg`,"TODO: Title from filename",c,d)}GetHeader(b,c,d,e){return this.SetTitle(b),a.wrap([this.GetLogo(),a.getText(b,"","","h1"),this.GetNav(c),this.GetMic(d,e)],"","","header")}GetNav(b){return console.log("GetNav",b),a.wrap(a.getText("nav"))}GetMic(b,c){return console.log("GetMic",b,c),a.wrap(this.GetIcon("021-microphone","mic"))}GetScrollWindow(b,c){return a.wrap(b,"scrollwindow",c)}Notify(b){this.notify||(this.notify=a.render(a.createElement("container","notify"),this.main,!0)),a.render(a.addHandler(a.getText(b),this.NotifyDestroy),this.notify)}NotifyDestroy(a){a.target.remove()}RenderLogin(){this.Clear(this.main),this.main.classList.add("login"),this.SetTitle("Login"),a.render(a.addHandler(a.getForm("login",[this.GetLogo(),a.getInput(a.getLabel("Username"),"text","username"),a.getInput(a.getLabel("Password"),"password","password")],"/",a.getInput("","submit","","Login","","shadowed")),this.handlers.LoginHandler),this.main)}RenderHome(){this.Clear(this.main),a.render([this.GetHeader("Script Selection"),a.wrap([this.GetScrollWindow(a.getButton("New Script",["secondary","shadowed"],"",this.handlers.EditScript)),a.wrap(this.GetIcon("014-next","point"),["flex","center"]),this.GetScrollWindow(a.getText("Script preview"))],["grid","col-50","split"])],this.main)}RenderScriptEdit(b){this.Clear(this.main),a.render([this.GetHeader("New Script"),a.getForm("name",[a.wrap([a.wrap([a.getInput(!1,"hidden","scriptID",b),a.getInput(a.getLabel("Title"),"text","title"),a.getInput(a.getLabel("Description"),"textarea","description")]),a.wrap([a.getText("Metadata","","","h2"),this.GetScrollWindow([a.getButton("Add Meta",["secondary","shadowed"],"",this.handlers.AddMeta)]),a.getText("test","","","div")],["grid","row-TWB"])],["grid","row-50"]),a.wrap([a.getText("Questions","","","h2"),this.GetScrollWindow([a.getButton("Add Question",["secondary","shadowed"],"",this.handlers.AddQuestion)]),a.wrap([a.getButton("Cancel",["secondary","shadowed"],"",this.handlers.CancelEdit),a.getButton("Store Script","shadowed","",this.handlers.StoreScript)],["buttonRow"])],["grid","row-TWB"])],"/",!1,["grid","col-50"])],this.main)}}{const a=new b("api"),c=new d;navigator.onLine?function(b){a.call({action:"testauth"},a=>b(a.status))}(a=>{a?c.RenderHome():c.RenderLogin()}):c.RenderHome()}})();